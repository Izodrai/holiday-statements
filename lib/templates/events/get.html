<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<link rel="stylesheet" href="../statics/style.css" />
	<title>{{.Title}}</title>
</head>

<body>
	<h1>{{.Title}}</h1>
	<nav>
		<ul>
			{{range .Nav}}
			<li><a href="{{ . }}"><input type="button" value="{{ . }}"></a></li>
			{{end}}
		</ul>
		<ul>
			<li><a href="/events"><input type="button" value="Retour à mes évènements"></a></li>
			<li><a href="/events?get={{.Actualize}}"><input type="button" value="Actualiser"></a></li>
		</ul>
	</nav>
	
	
	{{if .Added -}}
		<p>Dépense ajoutée</p>
	{{- end}}
	{{if .Error -}}
		<p>Problème lors de l'ajout de la dépense ou du chargement</p>
	{{- else}}
		{{if .Event -}}
		
		<h3>Ajouter une dépense:</h3>
		<table style="border-style:solid">
			<form name="add" method="post" action="/events?get={{.Actualize}}">
				<tr>
					<td>montant :</td>
					<td><input type="text" name="amount"/></td>
				</tr>
				<tr>
					<td>date de la dépense :</td>
					<td><input type="date" name="date" value="{{ .Date }}"/></td>
	<!-- 				<td><input type="text" name="date" value="{{ .Date }}"/></td> -->
				</tr>
				<tr>
					<td>qui a payé ? :</td>
					<td>
						{{- range .Event.Participants }}
						<input type="radio" name="payer" value="{{.Id}}"/><label for="payer">{{.Login}}</label><br/>
						{{- end}}
					</td>
				<tr>
				</tr>
					<td>pour qui ? :</td>
					<td>
						<input type="checkbox" name="allPaid" /><label for="allPaid">all</label><br/>
						{{- range .Event.Participants }}
						<input type="checkbox" name="{{.Id}}-Paid" /><label for="{{.Id}}-Paid">{{.Login}}</label><br/>
						{{- end}}
					</td>
				</tr>
				<tr>
					<td>description :</td>
					<td><textarea type="text" name="desc" id="desc"></textarea></td>
				</tr>
				<tr>
					<td>Type de la dépense :</td>
					<td>
					<select name="spdType">
						{{- range .SpendingTypes }}
							<option value="{{.Id}}">{{.Reference}}</option>
						{{- end}}
					</select>
					</td>
				</tr>
				<tr>
					<td colspan="2"><input type="submit" name="addSpd" value="Ajouter"/></td>
				</tr>
			</form>
		</table>
		
		<h3>Vos dernières dépenses :</h3>
		
		<table style="border-style:solid">
			<form name="deletion" method="post" action="/events?get={{.Actualize}}">
				<tr>
					<td padding="0.5px" style="border-style:solid;border-width:0px 0px 2px 0px">Date</td>
					<td padding="0.5px" style="border-style:solid;border-width:0px 0px 2px 0px">Montant</td>
					<td padding="0.5px" style="border-style:solid;border-width:0px 0px 2px 0px">Payeur</td>
					{{- range .Event.Participants }}
					<td padding="0.5px" style="border-style:solid;border-width:0px 0px 2px 0px">{{.Login}}</td>
					{{- end}}
					<td padding="0.5px" style="border-style:solid;border-width:0px 0px 2px 0px">Type de dépense</td>
					<td padding="0.5px" style="border-style:solid;border-width:0px 0px 2px 0px">Description</td>
					<td padding="0.5px" style="border-style:solid;border-width:0px 0px 2px 0px">Supprimer</td>
				</tr>
				
				{{- range .Event.Spending }}
				<tr>
					<td padding="0.5px">{{.Rows.Date}}</td>
					<td padding="0.5px">{{.Rows.Amount}}</td>
					<td padding="0.5px">{{.Rows.PayerName}}</td>
					{{- range .Rows.Debts }}
						<td padding="0.5px">{{.}}</td>
					{{- end}}
					<td padding="0.5px">{{.Rows.TypeSpending}}</td>
					<td padding="0.5px">{{.Rows.Description}}</td>
					<td padding="0.5px" style="text-align:center"><input type='checkbox' name='{{.Rows.Id}}-del'></td>
				</tr>
				{{- end}}
				<tr>
					<td colspan="10"><input type="submit" name="delSpd" value="Supprimer"/></td>
				</tr>
			</form>
		</table>
		
		<h3>Analyse des dépenses :</h3>

		<table style="border-style:solid">
			<tr>
				<td style="border-style:solid;border-width:0px 0px 2px 0px">Type de dépense:</td>
				<td style="border-style:solid;border-width:0px 0px 2px 0px">Total:</td>
			</tr>
			
			{{- range .ResultSpending.STotalSpendingByType }}
				<tr>
					<td padding="0.5px">{{.Name}} -> </td>
					<td padding="0.5px">{{.Amount}}</td>
				</tr>
			{{- end}}
		</table>
		
		<h3>Analyse des dettes :</h3>

		<table style="border-style:solid">
			{{- range .ResultDebts }}
				<tr>
					<td style="border-style:solid;border-width:0px 0px 2px 0px">{{.DebtorName}} a dépensé :</td>
					<td style="border-style:solid;border-width:0px 0px 2px 0px" padding="0.5px" collspan="2">{{.STotalSpending}}</td>
				</tr>
				
				{{- range .SDebts }}
					<tr>
						<td padding="0.5px"> -> Doit</td>
						<td padding="0.5px">{{.Amount}}</td>
						<td padding="0.5px">{{.Name}}</td>
					</tr>
				{{- end}}

			{{- end}}
		</table>
		
		{{- end}}
	{{- end}}
</body>
</html>